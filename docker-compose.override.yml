# Override configuration for development

services:
  backend:
    environment:
      # Development environment variables
      - DEBUG=true
      - LOG_LEVEL=DEBUG
      - ENVIRONMENT=development
      - RELOAD=true
      # Use polling mode for file watching on Windows/Docker (prevents I/O error 5)
      - WATCHFILES_FORCE_POLLING=true
      # Increase watcher timeout to handle Windows Docker startup delays
      - WATCHFILES_RUST_TIMEOUT=10000
    # Override CMD for development with auto-reload
    # Note: If you still see watchfiles errors on first startup, just restart the backend container
    command:
      - uvicorn
      - app.main:app
      - --host
      - 0.0.0.0
      - --port
      - "8000"
      - --reload
      - --reload-include
      - "*.py"
      - --reload-dir
      - /app/app
      - --log-level
      - debug
      - --use-colors
      - --access-log
      - --reload-delay
      - "3"
    # Enable code mounting for development (comment out for production)
    volumes:
      - ./backend:/app
      - backend_logs:/app/logs
      - uploads_data:/uploads

  # Override database for development with more permissive settings
  db:
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: miraiworks
      MYSQL_USER: hrms
      MYSQL_PASSWORD: hrms
      # Allow connections from any host in development
      MYSQL_ROOT_HOST: '%'
    command: --default-authentication-plugin=mysql_native_password --bind-address=0.0.0.0

volumes:
  backend_logs:
  uploads_data: